<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>WebSocket í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸</h1>
    <label for="nickname">ë‹‰ë„¤ì„ : </label>
    <input type="text" name="nickname" id="nickname">

    <button onclick="connect()">ì„œë²„ ì ‘ì†</button>
    <h1></h1>
    <button onclick="getRoomList()">ë°© ëª©ë¡</button>
    <button onclick="joinRoom()">ë°© ì°¸ê°€</button>
    <button onclick="ready()">ì¤€ë¹„ ì™„ë£Œ</button>
    <h1></h1>
    <div >
        <button onclick="createRoom()">ë°© ë§Œë“¤ê¸°</button>
        <label for="roomTitle">ë°© ì œëª© : </label>
        <input type="text" name="roomTitle" id="roomTitle">
        <label for="roomCap">ë°© ìµœëŒ€ ì¸ì› ìˆ˜ : </label>
        <input type="number" name="roomCap" id="roomCap" value="7" min="3" max="12">
    </div>
    <pre id="log"></pre>

    <script>
        const ws = new WebSocket('ws://mkmc.duckdns.org:8082'); // WebSocket ì„œë²„ ì£¼ì†Œ
        const log = document.getElementById('log');
        let roomId = null;
        let nickname = null;
        let userId = null;

        ws.onopen = () => {
            logMessage('âœ… WebSocket ì—°ê²° ì„±ê³µ');
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            logMessage(`ğŸ“© ì„œë²„ ì‘ë‹µ: ${event.data}`);
            if (data.type === 'connect'){
                userId = data.userId;
                console.log(typeof userId);
                logMessage(`ğŸ“± ì„œë²„ ì ‘ì†!`);
            } else if (data.type === 'roomCreated') {
                roomId = data.roomId;
                console.log(typeof roomId);
                logMessage(`ğŸ  ë°© ìƒì„± ì™„ë£Œ! ID: ${roomId}`);
            } else if (data.type === 'roomJoined') {
                roomId = data.roomId;
                logMessage(`ğŸ‘¥ ë°© ì°¸ê°€ ì™„ë£Œ! ID: ${roomId}`);
            } else if (data.type === 'gameStart') {
                logMessage('ğŸš€ ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else if(data.type === 'roomList'){
                rooms = data.rooms;
                logMessage('ğŸ“œ ë°© ëª©ë¡ ì¡°íšŒ!');
                for(const room of  rooms){
                    logMessage(`ë°©ì œëª© : ${room.title}`);
                    logMessage(`ìµœëŒ€ ìœ ì € ìˆ˜ : ${room.capacity}`);
                    logMessage(`í˜„ì¬ ìœ ì € ìˆ˜ : ${room.currentUsers}`);
                    logMessage('');
                }

            }
        };

        ws.onclose = () => {
            logMessage('âŒ WebSocket ì—°ê²° ì¢…ë£Œ');
        };

        ws.onerror = (error) => {
            logMessage('âš ï¸ WebSocket ì˜¤ë¥˜ ë°œìƒ');
            console.error(error);
        };
        
        function connect() {
            if (ws.readyState === WebSocket.OPEN) {
                let nickname = document.getElementById('nickname');
                nickname = nickname.value;
                if (nickname) {
                    ws.send(JSON.stringify({ type: 'connect', nickname }));
                } else {
                    logMessage('âš ï¸ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.');
                }
            } else {
                logMessage('âš ï¸ WebSocketì´ ì—°ê²°ë˜ì§€ ì•ŠìŒ');
            }
        }

        function createRoom() {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'createRoom', userId, title: roomTitle.value, capacity: roomCap.value }));
            } else {
                logMessage('âš ï¸ WebSocketì´ ì—°ê²°ë˜ì§€ ì•ŠìŒ');
            }
        }

        function joinRoom() {
            if (roomId) {
                ws.send(JSON.stringify({ type: 'joinRoom', roomId }));
            } else {
                logMessage('âš ï¸ ë¨¼ì € ë°©ì„ ìƒì„±í•˜ê±°ë‚˜, ì¡´ì¬í•˜ëŠ” ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            }
        }

        function ready() {
            if (roomId) {
                ws.send(JSON.stringify({ type: 'ready', roomId }));
            } else {
                logMessage('âš ï¸ ë°©ì— ì°¸ê°€í•´ì•¼ ì¤€ë¹„ ì™„ë£Œë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        function getRoomList(){
            ws.send(JSON.stringify(({ type: 'roomList'})))
        }
        function logMessage(message) {
            log.textContent += message + '\n';
        }
    </script>
</body>
</html>
